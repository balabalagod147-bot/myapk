#:kivy 2.3.0

<ColoredBar@Widget>:
    # 简易可变色/可变宽度的填充条
    bg_color: 0.39,0.43,0.45,1  # 背景灰
    fill_color: 0.84,0.19,0.19,1
    canvas.before:
        Color:
            rgba: self.bg_color
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [8]
    # 前景填充矩形，由父容器控制宽度
    canvas:
        Color:
            rgba: self.fill_color
        RoundedRectangle:
            size: (self.parent.width if not self.parent else self.width, self.height)
            pos: self.pos
            radius: [8]

<PasswordRoot>:
    orientation: "horizontal"
    padding: dp(16)
    spacing: dp(16)
    # 左侧：选项
    BoxLayout:
        orientation: "vertical"
        size_hint_x: 0.42
        spacing: dp(12)

        # 密码长度
        BoxLayout:
            size_hint_y: None
            height: dp(60)
            spacing: dp(8)
            Label:
                text: "密码长度"
                size_hint_x: None
                width: dp(90)
                halign: "left"
                valign: "middle"
                text_size: self.size
            Slider:
                id: len_slider
                min: 4
                max: 32
                step: 1
                value: root.length_value
                on_value: root.length_value = int(self.value)
            Label:
                text: str(root.length_value)
                size_hint_x: None
                width: dp(40)

        # 字符集
        BoxLayout:
            orientation: "vertical"
            padding: (dp(8), dp(8))
            spacing: dp(6)
            canvas.before:
                Color:
                    rgba: .15, .17, .18, 1
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [8]
            Label:
                text: "字符选项"
                size_hint_y: None
                height: dp(28)
                bold: True
            BoxLayout:
                CheckBox:
                    active: root.use_lower
                    on_active: root.use_lower = self.active
                Label:
                    text: "小写字母 (a-z)"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
            BoxLayout:
                CheckBox:
                    active: root.use_upper
                    on_active: root.use_upper = self.active
                Label:
                    text: "大写字母 (A-Z)"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
            BoxLayout:
                CheckBox:
                    active: root.use_digits
                    on_active: root.use_digits = self.active
                Label:
                    text: "数字 (0-9)"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
            BoxLayout:
                CheckBox:
                    active: root.use_symbols
                    on_active: root.use_symbols = self.active
                Label:
                    text: "特殊符号 (!@#$%^&*)"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
            BoxLayout:
                CheckBox:
                    active: root.exclude_similar
                    on_active: root.exclude_similar = self.active
                Label:
                    text: "排除相似字符 (I1LoO0)"
                    halign: "left"
                    valign: "middle"
                    text_size: self.size

            # 自定义字符
            BoxLayout:
                size_hint_y: None
                height: dp(40)
                spacing: dp(8)
                Label:
                    text: "自定义字符"
                    size_hint_x: None
                    width: dp(90)
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                TextInput:
                    text: root.custom_chars
                    hint_text: "可选，如 _-+=~"
                    on_text: root.custom_chars = self.text

        # 单次生成按钮
        Button:
            text: "生成密码"
            size_hint_y: None
            height: dp(44)
            on_release: root.generate_single()

        # 批量
        BoxLayout:
            orientation: "vertical"
            size_hint_y: None
            height: dp(120)
            spacing: dp(6)
            canvas.before:
                Color:
                    rgba: .15, .17, .18, 1
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [8]
            Label:
                text: "批量生成"
                size_hint_y: None
                height: dp(28)
                bold: True
            BoxLayout:
                size_hint_y: None
                height: dp(40)
                spacing: dp(8)
                TextInput:
                    id: batch_count
                    text: root.batch_count_text
                    input_filter: "int"
                    multiline: False
                    size_hint_x: None
                    width: dp(120)
                    on_text: root.batch_count_text = self.text
                Button:
                    text: "生成"
                    on_release: root.generate_batch()
                Button:
                    text: "复制全部"
                    on_release: root.copy_batch()

        Widget:

    # 右侧：结果
    BoxLayout:
        orientation: "vertical"
        size_hint_x: 0.58
        spacing: dp(12)

        # 单个结果
        BoxLayout:
            orientation: "vertical"
            padding: dp(8)
            spacing: dp(8)
            canvas.before:
                Color:
                    rgba: .15, .17, .18, 1
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [8]

            Label:
                text: "生成的密码"
                size_hint_y: None
                height: dp(26)
                bold: True

            TextInput:
                id: single_out
                text: root.single_result
                readonly: True
                font_name: ""
                font_size: dp(18)
                height: dp(46)
                size_hint_y: None

            # 强度条
            BoxLayout:
                orientation: "vertical"
                spacing: dp(6)
                size_hint_y: None
                height: dp(52)
                Label:
                    id: strength_label
                    text: "强度：0"
                    size_hint_y: None
                    height: dp(22)
                # 自定义颜色进度条
                FloatLayout:
                    size_hint_y: None
                    height: dp(18)
                    canvas.before:
                        Color:
                            rgba: .39, .43, .45, 1
                        RoundedRectangle:
                            size: self.size
                            pos: self.pos
                            radius: [9]
                    # 填充条
                    Widget:
                        id: strength_fill
                        size_hint: None, None
                        height: dp(18)
                        width: 0
                        pos: (self.parent.x, self.parent.y)
                        canvas.before:
                            Color:
                                rgba: root.strength_color
                            RoundedRectangle:
                                size: self.size
                                pos: self.pos
                                radius: [9]
                BoxLayout:
                    size_hint_y: None
                    height: dp(36)
                    Button:
                        text: "复制密码"
                        on_release: root.copy_single()

        # 批量结果
        BoxLayout:
            orientation: "vertical"
            padding: dp(8)
            spacing: dp(8)
            canvas.before:
                Color:
                    rgba: .15, .17, .18, 1
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [8]
            Label:
                text: "批量生成结果"
                size_hint_y: None
                height: dp(26)
                bold: True
            TextInput:
                id: batch_out
                text: root.batch_text
                readonly: True
                font_size: dp(16)
                size_hint_y: 1

            BoxLayout:
                size_hint_y: None
                height: dp(44)
                spacing: dp(8)
                Button:
                    text: "保存为 TXT"
                    on_release: root.save_txt()
                Button:
                    text: "保存为 Excel"
                    on_release: root.save_excel()
